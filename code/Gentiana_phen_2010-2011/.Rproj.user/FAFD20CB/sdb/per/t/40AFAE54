{
    "collab_server" : "",
    "contents" : "#2010\n#Read data\ndata10 <- read.table(\n  \"data1_2010.txt\",\n  header=TRUE, sep=\"\\t\", na.strings=\"NA\", dec=\",\", strip.white=TRUE)\nhead(data10)\nsummary(data10)\nstr(data10)\n\n#Standardize  reproductive traits\n\nmean_n_intact_fruits<-aggregate(n_intact_fruits~LokalID, data10, mean )\nmean_n_seeds<-aggregate(n_seeds~LokalID, data10, mean )\n\ndata10<-merge(data10,mean_n_intact_fruits, by=\"LokalID\")\ndata10<-merge(data10,mean_n_seeds, by=\"LokalID\")\n\nhead(data10)\n\nmean_n_shoots<-aggregate(n_shoots~LokalID, data10, mean )\nmean_h_shoot<-aggregate(h_shoot~LokalID, data10, mean )\nmean_n_fl<-aggregate(n_fl~LokalID, data10, mean )\nmean_phen_index<-aggregate(phen_index~LokalID, data10, mean )\nmean_most_adv<-aggregate(most_adv~LokalID, data10, mean )\n\nsd_n_shoots<-aggregate(n_shoots~LokalID, data10, sd )\nsd_h_shoot<-aggregate(h_shoot~LokalID, data10, sd )\nsd_n_fl<-aggregate(n_fl~LokalID, data10, sd )\nsd_phen_index<-aggregate(phen_index~LokalID, data10, sd )\nsd_most_adv<-aggregate(most_adv~LokalID, data10, sd )\n\ndata10<-merge(data10,mean_n_shoots, by=\"LokalID\")\ndata10<-merge(data10,mean_h_shoot, by=\"LokalID\")\ndata10<-merge(data10,mean_n_fl, by=\"LokalID\")\ndata10<-merge(data10,mean_phen_index, by=\"LokalID\")\ndata10<-merge(data10,mean_most_adv, by=\"LokalID\")\n\nhead(data10)\nnames(data10)\n\nnames(data10)[5:9]<-c(\"n_shoots\",\"h_shoot\",\"n_fl\",\"phen_index\",\"most_adv\")\nnames(data10)[14:15]<-c(\"n_intact_fruits\",\"n_seeds\")\nnames(data10)[17:18]<-c(\"n_intact_fruits_mean\",\"n_seeds_mean\")\n\nnames(data10)[19:23]<-c(\"n_shoots_mean\",\"h_shoot_mean\",\"n_fl_mean\",\"phen_index_mean\",\"most_adv_mean\")\n\ndata10<-merge(data10,sd_n_shoots, by=\"LokalID\")\ndata10<-merge(data10,sd_h_shoot, by=\"LokalID\")\ndata10<-merge(data10,sd_n_fl, by=\"LokalID\")\ndata10<-merge(data10,sd_phen_index, by=\"LokalID\")\ndata10<-merge(data10,sd_most_adv, by=\"LokalID\")\n\nnames(data10)\nnames(data10)[5:9]<-c(\"n_shoots\",\"h_shoot\",\"n_fl\",\"phen_index\",\"most_adv\")\nnames(data10)[24:28]<-c(\"n_shoots_sd\",\"h_shoot_sd\",\"n_fl_sd\",\"phen_index_sd\",\"most_adv_sd\")\n\nnames(data10)\n\ndata10$n_shoots_sta<-(data10$n_shoots-data10$n_shoots_mean)/data10$n_shoots_sd\ndata10$h_shoot_sta<-(data10$h_shoot-data10$h_shoot_mean)/data10$h_shoot_sd\ndata10$n_fl_sta<-(data10$n_fl-data10$n_fl_mean)/data10$n_fl_sd\ndata10$phen_index_sta<-(data10$phen_index-data10$phen_index_mean)/data10$phen_index_sd\ndata10$most_adv_sta<-(data10$most_adv-data10$most_adv_mean)/data10$most_adv_sd\n\nsummary(data10,by=\"LokalID\")\naggregate(n_shoots_sta~LokalID, data10, sd )\naggregate(h_shoot_sta~LokalID, data10, sd )\naggregate(n_fl_sta~LokalID, data10, sd )\naggregate(phen_index_sta~LokalID, data10, sd )\naggregate(most_adv_sta~LokalID, data10, sd )\n\ndata10$n_intact_fruits_sta<-data10$n_intact_fruits/data10$n_intact_fruits_mean\ndata10$n_seeds_sta<-data10$n_seeds/data10$n_seeds_mean\n\nsummary(data10,by=\"LokalID\")\naggregate(n_intact_fruits_sta~LokalID, data10, sd )\naggregate(n_seeds_sta~LokalID, data10, sd )\n\nnames(data10)\n\ndata10sta<-data10[c(1:4,16,29:33,10:13,34,35)]\nhead(data10sta)\nnames(data10sta)<-c(\"LokalID\",\"predator\",\"Lokal\",\"Individ\",\"attack\",\"n_shoots\",\"h_shoot\",\"n_fl\",\"phen_index\",\"most_adv\",\n                    \"n_eggs\",\"n_pred_all\",\"n_aborted_all\",\"perc_undeveloped\",\"n_intact_fruits\",\"n_seeds\")\nsummary(data10sta,by=\"LokalID\")\n\n#Effects of traits on fitness - removing n_shoots, adding quadratic and interaction terms\nlibrary(car)\n\n#Model with all populations, linear selection + interaction with population\nmodelfr_10<-lm(n_intact_fruits~most_adv+n_fl+h_shoot+\n                 LokalID:most_adv+LokalID:n_fl+LokalID:h_shoot,data=data10sta)\nAnova(modelfr_10,type=\"II\")\nsummary(lm(n_intact_fruits~most_adv+n_fl+h_shoot,data=data10sta))   #Get estimate for h_shoot\n\n#Model with all populations, linear selection + interaction between traits + interaction with population\nmodelfr_10_2<-lm(n_intact_fruits~most_adv+n_fl+h_shoot+\n                 most_adv:n_fl+most_adv:h_shoot+n_fl:h_shoot+\n                 LokalID:most_adv+LokalID:n_fl+LokalID:h_shoot,data=data10sta)\nAnova(modelfr_10_2,type=\"II\")   #interaction n_fl:h_shoot is significant\n\n#Model with all populations, non-linear selection + interaction with population\nmodelfr_10_3<-lm(n_intact_fruits~most_adv+n_fl+h_shoot+\n                   I(most_adv^2)+I(n_fl^2)+I(h_shoot^2)+\n                   LokalID:most_adv+LokalID:n_fl+LokalID:h_shoot+\n                   LokalID:I(most_adv^2)+LokalID:I(n_fl^2)+LokalID:I(h_shoot^2),\n                 data=data10sta)\nAnova(modelfr_10_3,type=\"II\")\n\n#Model with all populations, non-linear selection + interaction between traits + interaction with population -TOO COMPLICATED!\nmodelfr_10_4<-lm(n_intact_fruits~most_adv+n_fl+h_shoot+\n                   I(most_adv^2)+I(n_fl^2)+I(h_shoot^2)+\n                   most_adv:n_fl+most_adv:h_shoot+n_fl:h_shoot+\n                   most_adv:I(n_fl^2)+most_adv:I(h_shoot^2)+n_fl:I(most_adv^2)+\n                   n_fl:I(h_shoot^2)+h_shoot:I(most_adv^2)+h_shoot:I(n_fl^2)+\n                   I(most_adv^2):I(n_fl^2)+I(most_adv^2):I(h_shoot^2)+I(n_fl^2):I(h_shoot^2)+                                   \n                   LokalID:most_adv+LokalID:n_fl+LokalID:h_shoot+                                     \n                   LokalID:I(most_adv^2)+LokalID:I(n_fl^2)+LokalID:I(h_shoot^2),\n                   data=data10sta)\nAnova(modelfr_10_4,type=\"II\")\n\n\n\nwith(data10sta,plot(n_fl,n_intact_fruits))\nabline(lm(n_intact_fruits~n_fl,data=data10sta))\nsummary(lm(n_intact_fruits~n_fl,data=data10sta))\nsummary(lm(n_intact_fruits~I(n_fl^2),data=data10sta))\n\nggplot(data10sta, aes(x = n_fl, y = n_intact_fruits)) + geom_point()+\n  stat_smooth(method = \"lm\", formula = y ~ poly(x, 2), size = 1)\n\n\n#Models with predator term\n#Linear selection + predator\ndata10sta$predator<-as.factor(data10sta$predator)\nmodelfr_10_p<-lm(n_intact_fruits~most_adv+n_fl+h_shoot+\n                 predator:most_adv+predator:n_fl+predator:h_shoot,data=data10sta)\nAnova(modelfr_10_p,type=\"II\")\nsummary(lm(n_intact_fruits~most_adv+n_fl+h_shoot,data=data10sta))   #Get estimate for n_fl, h_shoot\n\n#Linear selection + interaction between traits + interaction with predator\nmodelfr_10_2_p<-lm(n_intact_fruits~most_adv+n_fl+h_shoot+\n                   most_adv:n_fl+most_adv:h_shoot+n_fl:h_shoot+\n                   predator:most_adv+predator:n_fl+predator:h_shoot,data=data10sta)\nAnova(modelfr_10_2_p,type=\"II\")   #interaction n_fl:h_shoot AND most_adv:h_shoot are significant\n\n#Non-linear selection + interaction with predator\nmodelfr_10_3_p<-lm(n_intact_fruits~most_adv+n_fl+h_shoot+\n                   I(most_adv^2)+I(n_fl^2)+I(h_shoot^2)+\n                     predator:most_adv+predator:n_fl+predator:h_shoot+\n                     predator:I(most_adv^2)+predator:I(n_fl^2)+predator:I(h_shoot^2),\n                 data=data10sta)\nAnova(modelfr_10_3_p,type=\"II\")\n\n#Separately for pops with / without predator\ndata10sta_pred<-subset(data10sta,predator==1)\ndata10sta_npred<-subset(data10sta,predator==0)\ndata10sta_pred$LokalID <- factor(data10sta_pred$LokalID)\ndata10sta_npred$LokalID <- factor(data10sta_npred$LokalID)\nlevels(data10sta_pred$LokalID)\nlevels(data10sta_npred$LokalID)\n\n#With predator, linear selection + interaction with population\nmodelfr_10_with<-lm(n_intact_fruits~most_adv+n_fl+h_shoot+\n                 LokalID:most_adv+LokalID:n_fl+LokalID:h_shoot,data=data10sta_pred)\nAnova(modelfr_10_with,type=\"II\")\nsummary(lm(n_intact_fruits~most_adv+n_fl+h_shoot,data=data10sta_pred))   #Get estimate for h_shoot\n\n#With predator, linear selection + interaction between traits + interaction with population\nmodelfr_10_2_with<-lm(n_intact_fruits~most_adv+n_fl+h_shoot+\n                   most_adv:n_fl+most_adv:h_shoot+n_fl:h_shoot+\n                   LokalID:most_adv+LokalID:n_fl+LokalID:h_shoot,data=data10sta_pred)\nAnova(modelfr_10_2_with,type=\"II\")   #interaction n_fl:h_shoot is significant\n\n#With predator, non-linear selection + interaction with population\nmodelfr_10_3_with<-lm(n_intact_fruits~most_adv+n_fl+h_shoot+\n                   I(most_adv^2)+I(n_fl^2)+I(h_shoot^2)+\n                   LokalID:most_adv+LokalID:n_fl+LokalID:h_shoot+\n                   LokalID:I(most_adv^2)+LokalID:I(n_fl^2)+LokalID:I(h_shoot^2),\n                 data=data10sta_pred)\nAnova(modelfr_10_3_with,type=\"II\")\nsummary(lm(n_intact_fruits~most_adv+n_fl+h_shoot+\n             I(most_adv^2)+I(n_fl^2)+I(h_shoot^2),\n           data=data10sta_pred))   #Get estimate for I(most_adv^2)\n\n#Without predator, linear selection + interaction with population\nmodelfr_10_without<-lm(n_intact_fruits~most_adv+n_fl+h_shoot+\n                      LokalID:most_adv+LokalID:n_fl+LokalID:h_shoot,data=data10sta_npred)\nAnova(modelfr_10_without,type=\"II\")\nsummary(lm(n_intact_fruits~most_adv+n_fl+h_shoot,data=data10sta_npred))   #Get estimate for most_adv\n\n#Without predator, linear selection + interaction between traits + interaction with population\nmodelfr_10_2_without<-lm(n_intact_fruits~most_adv+n_fl+h_shoot+\n                        most_adv:n_fl+most_adv:h_shoot+n_fl:h_shoot+\n                        LokalID:most_adv+LokalID:n_fl+LokalID:h_shoot,data=data10sta_npred)\nAnova(modelfr_10_2_without,type=\"II\")   #interaction most_adv:n_fl is significant\n\n#Without predator, non-linear selection + interaction with population\nmodelfr_10_3_without<-lm(n_intact_fruits~most_adv+n_fl+h_shoot+\n                        I(most_adv^2)+I(n_fl^2)+I(h_shoot^2)+\n                        LokalID:most_adv+LokalID:n_fl+LokalID:h_shoot+\n                        LokalID:I(most_adv^2)+LokalID:I(n_fl^2)+LokalID:I(h_shoot^2),\n                      data=data10sta_npred)\nAnova(modelfr_10_3_without,type=\"II\")\n\n#Linear selection gradients\n\nlibrary(lme4)\nlibrary(lattice)\n\ndata10staLokalID <- split(data10sta[1:2001,], data10sta[1:2001,]$LokalID)\n\nlsel_fr_10 <- lapply(data10staLokalID, function (x) {\n  lm(n_intact_fruits ~ most_adv+n_fl+h_shoot, \n     data = x)\n})\n\nlsel_fr_10\n\nlselcoefs_fr_10 <- vector(\"list\", 20) # create list\n\nfor (i in 1:20)  #this is 20 LokalID\n{\n  lselcoefs_fr_10[[i]]<-summary(lsel_fr_10[[i]])$coefficients\n}\n\nnames(lselcoefs_fr_10)<-names(lsel_fr_10)\nlselcoefs_fr_10\nlselcoefs_fr_10<-do.call(\"rbind\",lapply(lselcoefs_fr_10,FUN=data.frame))\nlselcoefs_fr_10\n#Add asterisks for significance\nlselcoefs_fr_10$sig <- ifelse(lselcoefs_fr_10$Pr...t.. < 0.05,\"*\", \"\")\nhead(lselcoefs_fr_10)\nwrite.table(lselcoefs_fr_10,file=\"lselcoefs_fr_10_most_adv.txt\",sep=\"\\t\")\n\n#Differences in linear selection gradients between populations with/without predator\nlsel_grads_10 <- read.table(\n  \"lsel_grads_most_adv.txt\",\n  header=TRUE, sep=\"\\t\", na.strings=\"NA\", dec=\",\", strip.white=TRUE)\nhead(lsel_grads_10)\nstr(lsel_grads_10)\nlsel_grads_10$pred<-as.factor(lsel_grads_10$pred)\n\npar(mfrow=c(1,2))\n\nsummary(lm(most_adv~pred,data=lsel_grads_10))\nplot(lsel_grads_10$pred,lsel_grads_10$most_adv,\n     xlab=\"Predator\",ylab=\"Selection gradient for phenology\")\nlegend(\"topright\", legend =\"p <0.001\",bty = \"n\")\n\nlibrary(Rcmdr)\nsummary(lm(h_shoot~pred,data=lsel_grads_10))\n\npar(mfrow=c(1,1),bty=\"l\",family=\"serif\",col=\"black\")\n\nplotMeans(lsel_grads_10$most_adv,lsel_grads_10$pred,\n          xlab=\"Predator\",ylab=\"Selection gradient for phenology\",main=NULL,\n          xlim=c(0.5,2.5),ylim=c(-0.3,0.4))\nlegend(\"top\", legend =\"p < 0.001\",bty = \"n\")\n\nplotMeans(lsel_grads_10$h_shoot,lsel_grads_10$pred,\n          xlab=\"Predator\",ylab=\"Selection gradient for shoot height\",main=NULL,\n          xlim=c(0.5,2.5),ylim=c(-0.3,0.4))\nlegend(\"top\", legend = \"p = 0.850\",bty = \"n\")\n\n#Graphs with ggplot2\n\nscience_theme <- theme_bw(base_family = \"serif\")+theme(panel.grid.major = element_line(size = 0, color = \"white\"),\n                                                       axis.line = element_line(size=.7, color = \"black\"), text = element_text(size=18),\n                                                       axis.title.x = element_text(vjust=-0.50,size=18),axis.title.y = element_text(vjust=0.70,size=18),\n                                                       axis.text.x=element_text(size=18),axis.text.y=element_text(size=18))+\n  theme( plot.background = element_blank() ,panel.grid.major = element_blank() ,\n         panel.grid.minor = element_blank() , panel.border = element_blank() ,\n         panel.background = element_blank() ) +  theme(axis.line = element_line(color = 'black'))\n\ndf1<-lsel_grads_10\ndf1\ndf1s <- summarySE(df1, measurevar=\"most_adv\", groupvars=c(\"pred\"))\ndf1s1 <- summarySE(df1, measurevar=\"h_shoot\", groupvars=c(\"pred\"))\n\nlibrary(ggplot2)\nggplot(df1s, aes(x=pred, y=most_adv)) + \n  geom_errorbar(aes(ymin=most_adv-se, ymax=most_adv+se), width=.1,size=.7) +\n  geom_line() +  geom_point(size=6)+science_theme+\n  scale_y_continuous(limits = c(-0.3, 0.4))+\n  labs(x = \"Predator\", y = \"Selection gradient for phenology\")\n\nggplot(df1s1, aes(x=pred, y=h_shoot)) + \n  geom_errorbar(aes(ymin=h_shoot-se, ymax=h_shoot+se), width=.1,size=.7) +\n  geom_line() +  geom_point(size=6)+science_theme+\n  scale_y_continuous(limits = c(-0.3, 0.4))+\n    labs(x = \"Predator\", y = \"Selection gradient for shoot height\")\n\n#Nonlinear selection gradients\n\nqsel_fr_10 <- lapply(data10staLokalID, function (x) {\n  lm(n_intact_fruits ~ most_adv+n_fl+h_shoot+\n       I(most_adv^2)+I(n_fl^2)+I(h_shoot^2), \n     data = x)\n})\n\nqsel_fr_10\n\nqselcoefs_fr_10 <- vector(\"list\", 20) # create list\n\nfor (i in 1:20)  #this is 20 LokalID\n{\n  qselcoefs_fr_10[[i]]<-summary(qsel_fr_10[[i]])$coefficients\n}\n\nnames(qselcoefs_fr_10)<-names(qsel_fr_10)\nqselcoefs_fr_10\nqselcoefs_fr_10<-do.call(\"rbind\",lapply(qselcoefs_fr_10,FUN=data.frame))\nqselcoefs_fr_10\n#Add asterisks for significance\nqselcoefs_fr_10$sig <- ifelse(qselcoefs_fr_10$Pr...t.. < 0.05,\"*\", \"\")\nhead(qselcoefs_fr_10)\nwrite.table(qselcoefs_fr_10,file=\"qselcoefs_fr_10_most_adv.txt\",sep=\"\\t\")\n\n#Differences in nonlinear selection gradients between populations with/without predator\nqsel_grads_10 <- read.table(\n  \"qsel_grads_most_adv.txt\",\n  header=TRUE, sep=\"\\t\", na.strings=\"NA\", dec=\",\", strip.white=TRUE)\nhead(qsel_grads_10)\nstr(qsel_grads_10)\nqsel_grads_10$pred<-as.factor(qsel_grads_10$pred)\n\nsummary(lm(most_adv2~pred,data=qsel_grads_10))\nsummary(lm(h_shoot2~pred,data=qsel_grads_10))\nsummary(lm(n_fl2~pred,data=qsel_grads_10))\n\n#################################################################################\n\n#2011\n#Read data\ndata11 <- read.table(\n  \"data1_2011.txt\",\n  header=TRUE, sep=\"\\t\", na.strings=\"NA\", dec=\",\", strip.white=TRUE)\nhead(data11)\nsummary(data11)\nstr(data11)\n\n#Standardize  reproductive traits\n\nmean_n_intact_fruits<-aggregate(n_intact_fruits~LokalID, data11, mean )\nmean_n_seeds<-aggregate(n_seeds~LokalID, data11, mean )\n\ndata11<-merge(data11,mean_n_intact_fruits, by=\"LokalID\")\ndata11<-merge(data11,mean_n_seeds, by=\"LokalID\")\n\nhead(data11)\n\nmean_n_shoots<-aggregate(n_shoots~LokalID, data11, mean )\nmean_h_shoot<-aggregate(h_shoot~LokalID, data11, mean )\nmean_n_fl<-aggregate(n_fl~LokalID, data11, mean )\nmean_phen_index<-aggregate(phen_index~LokalID, data11, mean )\nmean_most_adv<-aggregate(most_adv~LokalID, data11, mean )\n\nsd_n_shoots<-aggregate(n_shoots~LokalID, data11, sd )\nsd_h_shoot<-aggregate(h_shoot~LokalID, data11, sd )\nsd_n_fl<-aggregate(n_fl~LokalID, data11, sd )\nsd_phen_index<-aggregate(phen_index~LokalID, data11, sd )\nsd_most_adv<-aggregate(most_adv~LokalID, data11, sd )\n\ndata11<-merge(data11,mean_n_shoots, by=\"LokalID\")\ndata11<-merge(data11,mean_h_shoot, by=\"LokalID\")\ndata11<-merge(data11,mean_n_fl, by=\"LokalID\")\ndata11<-merge(data11,mean_phen_index, by=\"LokalID\")\ndata11<-merge(data11,mean_most_adv, by=\"LokalID\")\n\nhead(data11)\nnames(data11)\n\nnames(data11)[5:9]<-c(\"n_shoots\",\"h_shoot\",\"n_fl\",\"phen_index\",\"most_adv\")\nnames(data11)[14:15]<-c(\"n_intact_fruits\",\"n_seeds\")\nnames(data11)[17:18]<-c(\"n_intact_fruits_mean\",\"n_seeds_mean\")\n\nnames(data11)[19:23]<-c(\"n_shoots_mean\",\"h_shoot_mean\",\"n_fl_mean\",\"phen_index_mean\",\"most_adv_mean\")\n\ndata11<-merge(data11,sd_n_shoots, by=\"LokalID\")\ndata11<-merge(data11,sd_h_shoot, by=\"LokalID\")\ndata11<-merge(data11,sd_n_fl, by=\"LokalID\")\ndata11<-merge(data11,sd_phen_index, by=\"LokalID\")\ndata11<-merge(data11,sd_most_adv, by=\"LokalID\")\n\nnames(data11)\nnames(data11)[5:9]<-c(\"n_shoots\",\"h_shoot\",\"n_fl\",\"phen_index\",\"most_adv\")\nnames(data11)[24:28]<-c(\"n_shoots_sd\",\"h_shoot_sd\",\"n_fl_sd\",\"phen_index_sd\",\"most_adv_sd\")\n\nnames(data11)\n\ndata11$n_shoots_sta<-(data11$n_shoots-data11$n_shoots_mean)/data11$n_shoots_sd\ndata11$h_shoot_sta<-(data11$h_shoot-data11$h_shoot_mean)/data11$h_shoot_sd\ndata11$n_fl_sta<-(data11$n_fl-data11$n_fl_mean)/data11$n_fl_sd\ndata11$phen_index_sta<-(data11$phen_index-data11$phen_index_mean)/data11$phen_index_sd\ndata11$most_adv_sta<-(data11$most_adv-data11$most_adv_mean)/data11$most_adv_sd\n\nsummary(data11,by=\"LokalID\")\naggregate(n_shoots_sta~LokalID, data11, sd )\naggregate(h_shoot_sta~LokalID, data11, sd )\naggregate(n_fl_sta~LokalID, data11, sd )\naggregate(phen_index_sta~LokalID, data11, sd )\naggregate(most_adv_sta~LokalID, data11, sd )\n\ndata11$n_intact_fruits_sta<-data11$n_intact_fruits/data11$n_intact_fruits_mean\ndata11$n_seeds_sta<-data11$n_seeds/data11$n_seeds_mean\n\nsummary(data11,by=\"LokalID\")\naggregate(n_intact_fruits_sta~LokalID, data11, sd )\naggregate(n_seeds_sta~LokalID, data11, sd )\n\nnames(data11)\n\ndata11sta<-data11[c(1:4,16,29:33,10:13,34,35)]\nhead(data11sta)\nnames(data11sta)<-c(\"LokalID\",\"predator\",\"Lokal\",\"Individ\",\"attack\",\"n_shoots\",\"h_shoot\",\"n_fl\",\"phen_index\",\"most_adv\",\n                    \"n_eggs\",\"n_pred_all\",\"n_aborted_all\",\"perc_undeveloped\",\"n_intact_fruits\",\"n_seeds\")\nsummary(data11sta,by=\"LokalID\")\n\n#Effects of traits on fitness - removing n_shoots, adding quadratic and interaction terms\nlibrary(car)\n\n#Model with all populations, linear selection + interaction with population\nmodelfr_11<-lm(n_intact_fruits~most_adv+n_fl+h_shoot+\n                 LokalID:most_adv+LokalID:n_fl+LokalID:h_shoot,data=data11sta)\nAnova(modelfr_11,type=\"II\")\n\n#Model with all populations, linear selection + interaction between traits + interaction with population\nmodelfr_11_2<-lm(n_intact_fruits~most_adv+n_fl+h_shoot+\n                   most_adv:n_fl+most_adv:h_shoot+n_fl:h_shoot+\n                   LokalID:most_adv+LokalID:n_fl+LokalID:h_shoot,data=data11sta)\nAnova(modelfr_11_2,type=\"II\")   #interaction n_fl:h_shoot is significant\n\n#Model with all populations, non-linear selection + interaction with population\nmodelfr_11_3<-lm(n_intact_fruits~most_adv+n_fl+h_shoot+\n                   I(most_adv^2)+I(n_fl^2)+I(h_shoot^2)+\n                   LokalID:most_adv+LokalID:n_fl+LokalID:h_shoot+\n                   LokalID:I(most_adv^2)+LokalID:I(n_fl^2)+LokalID:I(h_shoot^2),\n                 data=data11sta)\nAnova(modelfr_11_3,type=\"II\")\n\n#Model with all populations, non-linear selection + interaction between traits + interaction with population -TOO COMPLICATED!\nmodelfr_11_4<-lm(n_intact_fruits~most_adv+n_fl+h_shoot+\n                   I(most_adv^2)+I(n_fl^2)+I(h_shoot^2)+\n                   most_adv:n_fl+most_adv:h_shoot+n_fl:h_shoot+\n                   most_adv:I(n_fl^2)+most_adv:I(h_shoot^2)+n_fl:I(most_adv^2)+\n                   n_fl:I(h_shoot^2)+h_shoot:I(most_adv^2)+h_shoot:I(n_fl^2)+\n                   I(most_adv^2):I(n_fl^2)+I(most_adv^2):I(h_shoot^2)+I(n_fl^2):I(h_shoot^2)+                                   \n                   LokalID:most_adv+LokalID:n_fl+LokalID:h_shoot+                                     \n                   LokalID:I(most_adv^2)+LokalID:I(n_fl^2)+LokalID:I(h_shoot^2),\n                 data=data11sta)\nAnova(modelfr_11_4,type=\"II\")\n\n\n\nwith(data11sta,plot(n_fl,n_intact_fruits))\nabline(lm(n_intact_fruits~n_fl,data=data11sta))\nsummary(lm(n_intact_fruits~n_fl,data=data11sta))\nsummary(lm(n_intact_fruits~I(n_fl^2),data=data11sta))\n\nggplot(data11sta, aes(x = n_fl, y = n_intact_fruits)) + geom_point()+\n  stat_smooth(method = \"lm\", formula = y ~ poly(x, 2), size = 1)\n\n\n#Models with predator term\n#Linear selection + predator\ndata11sta$predator<-as.factor(data11sta$predator)\nmodelfr_11_p<-lm(n_intact_fruits~most_adv+n_fl+h_shoot+\n                   predator:most_adv+predator:n_fl+predator:h_shoot,data=data11sta)\nAnova(modelfr_11_p,type=\"II\")\n\n#Linear selection + interaction between traits + interaction with predator\nmodelfr_11_2_p<-lm(n_intact_fruits~most_adv+n_fl+h_shoot+\n                     most_adv:n_fl+most_adv:h_shoot+n_fl:h_shoot+\n                     predator:most_adv+predator:n_fl+predator:h_shoot,data=data11sta)\nAnova(modelfr_11_2_p,type=\"II\")   \n\n#Non-linear selection + interaction with predator\nmodelfr_11_3_p<-lm(n_intact_fruits~most_adv+n_fl+h_shoot+\n                     I(most_adv^2)+I(n_fl^2)+I(h_shoot^2)+\n                     predator:most_adv+predator:n_fl+predator:h_shoot+\n                     predator:I(most_adv^2)+predator:I(n_fl^2)+predator:I(h_shoot^2),\n                   data=data11sta)\nAnova(modelfr_11_3_p,type=\"II\")\n\n#Separately for pops with / without predator\ndata11sta_pred<-subset(data11sta,predator==1)\ndata11sta_npred<-subset(data11sta,predator==0)\ndata11sta_pred$LokalID <- factor(data11sta_pred$LokalID)\ndata11sta_npred$LokalID <- factor(data11sta_npred$LokalID)\nlevels(data11sta_pred$LokalID)\nlevels(data11sta_npred$LokalID)\n\n#With predator, linear selection + interaction with population\nmodelfr_11_with<-lm(n_intact_fruits~most_adv+n_fl+h_shoot+\n                      LokalID:most_adv+LokalID:n_fl+LokalID:h_shoot,data=data11sta_pred)\nAnova(modelfr_11_with,type=\"II\")\nsummary(lm(n_intact_fruits~most_adv+n_fl+h_shoot,data=data11sta_pred))   #Get estimate for h_shoot\n\n#With predator, linear selection + interaction between traits + interaction with population\nmodelfr_11_2_with<-lm(n_intact_fruits~most_adv+n_fl+h_shoot+\n                        most_adv:n_fl+most_adv:h_shoot+n_fl:h_shoot+\n                        LokalID:most_adv+LokalID:n_fl+LokalID:h_shoot,data=data11sta_pred)\nAnova(modelfr_11_2_with,type=\"II\")   #interactions n_fl:h_shoot AND most_adv:h_shoot are significant\n\n#With predator, non-linear selection + interaction with population\nmodelfr_11_3_with<-lm(n_intact_fruits~most_adv+n_fl+h_shoot+\n                        I(most_adv^2)+I(n_fl^2)+I(h_shoot^2)+\n                        LokalID:most_adv+LokalID:n_fl+LokalID:h_shoot+\n                        LokalID:I(most_adv^2)+LokalID:I(n_fl^2)+LokalID:I(h_shoot^2),\n                      data=data11sta_pred)\nAnova(modelfr_11_3_with,type=\"II\")\nsummary(lm(n_intact_fruits~most_adv+n_fl+h_shoot+\n             I(most_adv^2)+I(n_fl^2)+I(h_shoot^2),\n           data=data11sta_pred))   \n\n#Without predator, linear selection + interaction with population\nmodelfr_11_without<-lm(n_intact_fruits~most_adv+n_fl+h_shoot+\n                         LokalID:most_adv+LokalID:n_fl+LokalID:h_shoot,data=data11sta_npred)\nAnova(modelfr_11_without,type=\"II\")\nsummary(lm(n_intact_fruits~most_adv+n_fl+h_shoot,data=data11sta_npred))   #Get estimate for most_adv and n_fl\n\n#Without predator, linear selection + interaction between traits + interaction with population\nmodelfr_11_2_without<-lm(n_intact_fruits~most_adv+n_fl+h_shoot+\n                           most_adv:n_fl+most_adv:h_shoot+n_fl:h_shoot+\n                           LokalID:most_adv+LokalID:n_fl+LokalID:h_shoot,data=data11sta_npred)\nAnova(modelfr_11_2_without,type=\"II\")   #no significant interactions\n\n#Without predator, non-linear selection + interaction with population\nmodelfr_11_3_without<-lm(n_intact_fruits~most_adv+n_fl+h_shoot+\n                           I(most_adv^2)+I(n_fl^2)+I(h_shoot^2)+\n                           LokalID:most_adv+LokalID:n_fl+LokalID:h_shoot+\n                           LokalID:I(most_adv^2)+LokalID:I(n_fl^2)+LokalID:I(h_shoot^2),\n                         data=data11sta_npred)\nAnova(modelfr_11_3_without,type=\"II\")\n\n#Linear selection gradients\n\nlibrary(lme4)\nlibrary(lattice)\n\ndata11staLokalID <- split(data11sta, data11sta$LokalID)\n\nlsel_fr_11 <- lapply(data11staLokalID, function (x) {\n  lm(n_intact_fruits ~ most_adv+n_fl+h_shoot, \n     data = x)\n})\n\nlsel_fr_11\n\nlselcoefs_fr_11 <- vector(\"list\", 16) # create list\n\nfor (i in 1:16)  #this is 16 LokalID\n{\n  lselcoefs_fr_11[[i]]<-summary(lsel_fr_11[[i]])$coefficients\n}\n\nnames(lselcoefs_fr_11)<-names(lsel_fr_11)\nlselcoefs_fr_11\nlselcoefs_fr_11<-do.call(\"rbind\",lapply(lselcoefs_fr_11,FUN=data.frame))\nlselcoefs_fr_11\n#Add asterisks for significance\nlselcoefs_fr_11$sig <- ifelse(lselcoefs_fr_11$Pr...t.. < 0.05,\"*\", \"\")\nhead(lselcoefs_fr_11)\nwrite.table(lselcoefs_fr_11,file=\"lselcoefs_fr_11_most_adv.txt\",sep=\"\\t\")\n\n#Differences in linear selection gradients between populations with/without predator\nlsel_grads_11 <- read.table(\n  \"lsel_grads_11_most_adv.txt\",\n  header=TRUE, sep=\"\\t\", na.strings=\"NA\", dec=\",\", strip.white=TRUE)\nhead(lsel_grads_11)\nstr(lsel_grads_11)\nlsel_grads_11$pred<-as.factor(lsel_grads_11$pred)\n\npar(mfrow=c(1,2))\n\nsummary(lm(most_adv~pred,data=lsel_grads_11))\nplot(lsel_grads_11$pred,lsel_grads_11$most_adv,\n     xlab=\"Predator\",ylab=\"Selection gradient for phenology\")\nlegend(\"topright\", legend =\"p <0.001\",bty = \"n\")\n\nlibrary(Rcmdr)\nsummary(lm(h_shoot~pred,data=lsel_grads_11))\n\npar(mfrow=c(1,1),bty=\"l\",family=\"serif\",col=\"black\")\n\nplotMeans(lsel_grads_11$most_adv,lsel_grads_11$pred,\n          xlab=\"Predator\",ylab=\"Selection gradient for phenology\",main=NULL,\n          xlim=c(0.5,2.5),ylim=c(-0.3,0.4))\nlegend(\"top\", legend =\"p < 0.001\",bty = \"n\")\n\nplotMeans(lsel_grads_11$h_shoot,lsel_grads_11$pred,\n          xlab=\"Predator\",ylab=\"Selection gradient for shoot height\",main=NULL,\n          xlim=c(0.5,2.5),ylim=c(-0.3,0.4))\nlegend(\"top\", legend = \"p = 0.046\",bty = \"n\")\n\n#Graphs with ggplot2\n\nscience_theme <- theme_bw(base_family = \"serif\")+theme(panel.grid.major = element_line(size = 0, color = \"white\"),\n                                                       axis.line = element_line(size=.7, color = \"black\"), text = element_text(size=18),\n                                                       axis.title.x = element_text(vjust=-0.50,size=18),axis.title.y = element_text(vjust=0.70,size=18),\n                                                       axis.text.x=element_text(size=18),axis.text.y=element_text(size=18))+\n  theme( plot.background = element_blank() ,panel.grid.major = element_blank() ,\n         panel.grid.minor = element_blank() , panel.border = element_blank() ,\n         panel.background = element_blank() ) +  theme(axis.line = element_line(color = 'black'))\n\ndf1<-lsel_grads_11\ndf1\ndf1s <- summarySE(df1, measurevar=\"most_adv\", groupvars=c(\"pred\"))\ndf1s1 <- summarySE(df1, measurevar=\"h_shoot\", groupvars=c(\"pred\"))\n\nlibrary(ggplot2)\nggplot(df1s, aes(x=pred, y=most_adv)) + \n  geom_errorbar(aes(ymin=most_adv-se, ymax=most_adv+se), width=.1,size=.7) +\n  geom_line() +  geom_point(size=6)+science_theme+\n  scale_y_continuous(limits = c(-0.3, 0.4))+\n  labs(x = \"Predator\", y = \"Selection gradient for phenology\")\n\nggplot(df1s1, aes(x=pred, y=h_shoot)) + \n  geom_errorbar(aes(ymin=h_shoot-se, ymax=h_shoot+se), width=.1,size=.7) +\n  geom_line() +  geom_point(size=6)+science_theme+\n  scale_y_continuous(limits = c(-0.3, 0.4))+\n  labs(x = \"Predator\", y = \"Selection gradient for shoot height\")\n\n#Nonlinear selection gradients\n\nqsel_fr_11 <- lapply(data11staLokalID, function (x) {\n  lm(n_intact_fruits ~ most_adv+n_fl+h_shoot+\n       I(most_adv^2)+I(n_fl^2)+I(h_shoot^2), \n     data = x)\n})\n\nqsel_fr_11\n\nqselcoefs_fr_11 <- vector(\"list\", 16) # create list\n\nfor (i in 1:16)  #this is 16 LokalID\n{\n  qselcoefs_fr_11[[i]]<-summary(qsel_fr_11[[i]])$coefficients\n}\n\nnames(qselcoefs_fr_11)<-names(qsel_fr_11)\nqselcoefs_fr_11\nqselcoefs_fr_11<-do.call(\"rbind\",lapply(qselcoefs_fr_11,FUN=data.frame))\nqselcoefs_fr_11\n#Add asterisks for significance\nqselcoefs_fr_11$sig <- ifelse(qselcoefs_fr_11$Pr...t.. < 0.05,\"*\", \"\")\nhead(qselcoefs_fr_11)\nwrite.table(qselcoefs_fr_11,file=\"qselcoefs_fr_11_most_adv.txt\",sep=\"\\t\")\n\n#Differences in nonlinear selection gradients between populations with/without predator\nqsel_grads_11 <- read.table(\n  \"qsel_grads_11_most_adv.txt\",\n  header=TRUE, sep=\"\\t\", na.strings=\"NA\", dec=\",\", strip.white=TRUE)\nhead(qsel_grads_11)\nstr(qsel_grads_11)\nqsel_grads_11$pred<-as.factor(qsel_grads_11$pred)\n\nsummary(lm(most_adv2~pred,data=qsel_grads_11))\nsummary(lm(h_shoot2~pred,data=qsel_grads_11))\nsummary(lm(n_fl2~pred,data=qsel_grads_11))\n\n##########################################################\n\n\n#2010\n\n#Effects of traits on interaction intensity\n#Linear\n\nint1_10<-lm(n_eggs~most_adv+n_fl+h_shoot+LokalID*most_adv+\n              LokalID*n_fl+LokalID*h_shoot,data=subset(data10sta[1:2001,],predator==1&LokalID!=\"Göt016\"))\nAnova(int1_10,type=\"II\")\n\n#Random? - does not help a lot if we want to see differences between populations\nsummary(lmer(n_eggs~most_adv+n_fl+h_shoot+(1|LokalID)+\n             (1|LokalID:most_adv)+(1|LokalID:n_fl)+(1|LokalID:h_shoot),\n           data=subset(data10sta,predator==1)))\nAnova(lmer(n_eggs~most_adv+n_fl+h_shoot+(1|LokalID)+\n             (1|LokalID:most_adv)+(1|LokalID:n_fl)+(1|LokalID:h_shoot),\n           data=subset(data10sta,predator==1)))\n\nAnova(glm(attack~most_adv+n_fl+h_shoot+LokalID*most_adv+\n           LokalID*n_fl+LokalID*h_shoot,data=subset(data10sta[1:2001,],predator==1&LokalID!=\"Göt016\"),family=\"binomial\"),type=\"II\")\nsummary(glm(attack~most_adv+n_fl+h_shoot,data=subset(data10sta[1:2001,],predator==1&LokalID!=\"Göt016\"),family=\"binomial\"),type=\"II\")\n\n#Linear + interaction\nAnova(lm(n_eggs~(most_adv+n_fl+h_shoot)*LokalID+\n           (most_adv:n_fl+most_adv:h_shoot+n_fl:h_shoot)*LokalID,\n           data=subset(data10sta,predator==1)),type=\"II\")\n\nAnova(lm(attack~(most_adv+n_fl+h_shoot)*LokalID+\n           (most_adv:n_fl+most_adv:h_shoot+n_fl:h_shoot)*LokalID,\n         data=subset(data10sta,predator==1)),type=\"II\")\n\n#Linear + quadratic\nAnova(lm(n_eggs~most_adv+n_fl+h_shoot+\n           LokalID*most_adv+LokalID*n_fl+LokalID*h_shoot+\n           I(most_adv^2)+I(n_fl^2)+I(h_shoot^2)+\n           LokalID:I(most_adv^2)+LokalID:I(n_fl^2)+LokalID:I(h_shoot^2),           \n           data=subset(data10sta,predator==1)),type=\"II\")\n\nAnova(lm(attack~most_adv+n_fl+h_shoot+\n           LokalID*most_adv+LokalID*n_fl+LokalID*h_shoot+\n           I(most_adv^2)+I(n_fl^2)+I(h_shoot^2)+\n           LokalID:I(most_adv^2)+LokalID:I(n_fl^2)+LokalID:I(h_shoot^2),           \n         data=subset(data10sta,predator==1)),type=\"II\")\n\n\n#2011\n\n#Effects of traits on interaction intensity\n#Linear\n\nint1_11<-lm(n_eggs~most_adv+n_fl+h_shoot+LokalID*most_adv+\n              LokalID*n_fl+LokalID*h_shoot,data=subset(data11sta,predator==1))\nAnova(int1_11,type=\"II\")\n\nAnova(glm(attack~most_adv+n_fl+h_shoot+LokalID*most_adv+\n            LokalID*n_fl+LokalID*h_shoot,data=subset(data11sta,predator==1),family=\"binomial\"),type=\"II\")\n\n\n#Linear + interaction\nAnova(lm(n_eggs~(most_adv+n_fl+h_shoot)*LokalID+\n           (most_adv:n_fl+most_adv:h_shoot+n_fl:h_shoot)*LokalID,\n         data=subset(data11sta,predator==1)),type=\"II\")\n\nAnova(lm(attack~(most_adv+n_fl+h_shoot)*LokalID+\n           (most_adv:n_fl+most_adv:h_shoot+n_fl:h_shoot)*LokalID,\n         data=subset(data11sta,predator==1)),type=\"II\")\n\n\nsummary(lm(attack~(most_adv+n_fl+h_shoot)^2,\n         data=subset(data11sta,predator==1)),type=\"II\")\n\n#Linear + quadratic\nAnova(lm(n_eggs~most_adv+n_fl+h_shoot+\n           LokalID*most_adv+LokalID*n_fl+LokalID*h_shoot+\n           I(most_adv^2)+I(n_fl^2)+I(h_shoot^2)+\n           LokalID:I(most_adv^2)+LokalID:I(n_fl^2)+LokalID:I(h_shoot^2),           \n         data=subset(data11sta,predator==1)),type=\"II\")\n\nAnova(lm(attack~most_adv+n_fl+h_shoot+\n           LokalID*most_adv+LokalID*n_fl+LokalID*h_shoot+\n           I(most_adv^2)+I(n_fl^2)+I(h_shoot^2)+\n           LokalID:I(most_adv^2)+LokalID:I(n_fl^2)+LokalID:I(h_shoot^2),           \n         data=subset(data11sta,predator==1)),type=\"II\")\n\nsummary(lm(attack~most_adv+n_fl+h_shoot+\n           I(most_adv^2)+I(n_fl^2)+I(h_shoot^2),           \n         data=subset(data11sta,predator==1)))   \n#Get estimate for I(most_adv^2) and I(n_fl^2)\n\n#2010\n\n#Effects of traits on interaction intensity: models for each population\n\ndata10sta_pred<-subset(data10sta[1:2001,],predator==1)\nlevels(data10sta_pred$LokalID)\ndata10sta_pred$LokalID <- factor(data10sta_pred$LokalID)\nlevels(data10sta_pred$LokalID)\n\ndata10sta_predLokalID <- split(data10sta_pred, data10sta_pred$LokalID)\n\nint_1_10_pops <- lapply(data10sta_predLokalID, function (x) {\n  lm(n_eggs ~ most_adv+n_fl+h_shoot, \n     data = x)\n})\n\nint_1_10_pops\n\nint_1_10_pops_coefs <- vector(\"list\", 11) # create list\n\nfor (i in 1:11)  #this is 11 LokalID\n{\n  int_1_10_pops_coefs[[i]]<-summary(int_1_10_pops[[i]])$coefficients\n}\n\nnames(int_1_10_pops_coefs)<-names(int_1_10_pops)\nint_1_10_pops_coefs\nint_1_10_pops_coefs<-do.call(\"rbind\",lapply(int_1_10_pops_coefs,FUN=data.frame))\nint_1_10_pops_coefs\n#Add asterisks for significance\nint_1_10_pops_coefs$sig <- ifelse(int_1_10_pops_coefs$Pr...t.. < 0.05,\"*\", \"\")\nhead(int_1_10_pops_coefs)\nwrite.table(int_1_10_pops_coefs,file=\"int_1_10_pops_coefs.txt\",sep=\"\\t\")\n\n##Effects of traits on interaction intensity: graphs for each population\nhead(data10_pred)\nstr(data10_pred)\n\nlibrary(ggplot2)\n\ncbbPalette <- c(\"#000000\", \"#E69F00\", \"#56B4E9\", \"#009E73\", \"#F0E442\", \"#0072B2\", \"#D55E00\", \"#CC79A7\",\"#CC6666\", \"#9999CC\", \"#66CC99\")\n\nggplot(data10_pred, aes(x=most_adv, y=attack,color=LokalID)) +\n  geom_smooth(method=lm, se=FALSE, size=0.7,fullrange=T)+ \n  scale_x_continuous(breaks=c(0,1,2,3,4,5,6))+\n  labs(x = \"Most advanced bud\", y = \"Number of eggs\")+\n  science_theme+scale_colour_manual(values=cbbPalette)\n\nggplot(data10_pred, aes(x=n_fl, y=n_eggs,color=LokalID)) +\n  geom_smooth(method=lm, se=FALSE, size=0.7,fullrange=T)+ \n  labs(x = \"Number of flowers\", y = \"Number of eggs\")+\n  science_theme+scale_colour_manual(values=cbbPalette)\n\n#Significance?\n\n\nphen10 <- lapply(data10sta_predLokalID, function (x) {\n  lm(scale(n_eggs) ~ most_adv, \n     data = x)\n})\n\nphen10coefs<-vector(\"list\", 11) # create list\n\nfor (i in 1:11)  #this is 11 LokalID\n{\n  phen10coefs[[i]]<-summary(phen10[[i]])$coefficients\n}\n\nphen10coefs\n\nnames(phen10coefs)<-names(phen10)\nphen10coefs\nphen10coefs<-do.call(\"rbind\",lapply(phen10coefs,FUN=data.frame))\nphen10coefs\n#Add asterisks for significance\nphen10coefs$sig <- ifelse(phen10coefs$Pr...t.. < 0.05,\"*\", \"\")\nphen10coefs\n\n\n#2011\n\n#Effects of traits on interaction intensity\n\nint1_11<-lm(n_eggs~most_adv+n_fl+h_shoot+LokalID*most_adv+\n              LokalID*n_fl+LokalID*n_shoots+LokalID*h_shoot,data=subset(data11sta,predator==1))\nAnova(int1_11,type=\"II\")\n\n#Effects of traits on interaction intensity: models for each population\n\ndata11sta_pred<-subset(data11sta,predator==1)\nlevels(data11sta_pred$LokalID)\ndata11sta_pred$LokalID <- factor(data11sta_pred$LokalID)\nlevels(data11sta_pred$LokalID)\n\ndata11sta_predLokalID <- split(data11sta_pred, data11sta_pred$LokalID)\n\nint_1_11_pops <- lapply(data11sta_predLokalID, function (x) {\n  lm(n_eggs ~ most_adv+n_fl+h_shoot, \n     data = x)\n})\n\nint_1_11_pops\n\nint_1_11_pops_coefs <- vector(\"list\", 11) # create list\n\nfor (i in 1:11)  #this is 11 LokalID\n{\n  int_1_11_pops_coefs[[i]]<-summary(int_1_11_pops[[i]])$coefficients\n}\n\nnames(int_1_11_pops_coefs)<-names(int_1_11_pops)\nint_1_11_pops_coefs\nint_1_11_pops_coefs<-do.call(\"rbind\",lapply(int_1_11_pops_coefs,FUN=data.frame))\nint_1_11_pops_coefs\n#Add asterisks for significance\nint_1_11_pops_coefs$sig <- ifelse(int_1_11_pops_coefs$Pr...t.. < 0.05,\"*\", \"\")\nhead(int_1_11_pops_coefs)\nwrite.table(int_1_11_pops_coefs,file=\"int_1_11_pops_coefs.txt\",sep=\"\\t\")\n\n##Effects of traits on interaction intensity: graphs for each population\n#2011\n\nggplot(data11_pred, aes(x=most_adv, y=n_eggs,color=LokalID)) +\n  geom_smooth(method=lm, se=FALSE, size=1,fullrange=T)+ \n  scale_x_continuous(breaks=c(0,1,2,3,4,5,6))+\n  labs(x = \"Most advanced bud\", y = \"Number of eggs\")+\n  science_theme+scale_colour_manual(values=cbbPalette)\n\n#Significance?\n#2011\nphen11 <- lapply(data11sta_predLokalID, function (x) {\n  lm(scale(n_eggs) ~ most_adv, \n     data = x)\n})\n\nphen11coefs<-vector(\"list\", 11) # create list\n\nfor (i in 1:11)  #this is 11 LokalID\n{\n  phen11coefs[[i]]<-summary(phen11[[i]])$coefficients\n}\n\nphen11coefs\n\nnames(phen11coefs)<-names(phen11)\nphen11coefs\nphen11coefs<-do.call(\"rbind\",lapply(phen11coefs,FUN=data.frame))\nphen11coefs\n#Add asterisks for significance\nphen11coefs$sig <- ifelse(phen11coefs$Pr...t.. < 0.05,\"*\", \"\")\nphen11coefs\n\n#2010\nphen10bis <- lapply(data10sta_predLokalID, function (x) {\n  glm(attack ~ most_adv, \n     family= binomial,data = x)\n})\n\nphen10biscoefs<-vector(\"list\", 11) # create list\n\nfor (i in 1:11)  #this is 11 LokalID\n{\n  phen10biscoefs[[i]]<-summary(phen10bis[[i]])$coefficients\n}\n\nphen10biscoefs\n\nnames(phen10biscoefs)<-names(phen10bis)\nphen10biscoefs\nphen10biscoefs<-do.call(\"rbind\",lapply(phen10biscoefs,FUN=data.frame))\nphen10biscoefs\n#Add asterisks for significance\nphen10biscoefs$sig <- ifelse(phen10biscoefs$Pr...z.. < 0.05,\"*\", \"\")\nphen10biscoefs\n\n#2011\nphen11bis <- lapply(data11sta_predLokalID, function (x) {\n  glm(attack ~ most_adv, \n      family= binomial,data = x)\n})\n\nphen11biscoefs<-vector(\"list\", 11) # create list\n\nfor (i in 1:11)  #this is 11 LokalID\n{\n  phen11biscoefs[[i]]<-summary(phen11bis[[i]])$coefficients\n}\n\nphen11biscoefs\n\nnames(phen11biscoefs)<-names(phen11bis)\nphen11biscoefs\nphen11biscoefs<-do.call(\"rbind\",lapply(phen11biscoefs,FUN=data.frame))\nphen11biscoefs\n#Add asterisks for significance\nphen11biscoefs$sig <- ifelse(phen11biscoefs$Pr...z.. < 0.05,\"*\", \"\")\nphen11biscoefs\n\n\nphen10biscoefs\nphen11biscoefs #Copy to JMP!\n\n########################################################################\n\n#Predator preference coefficients (phen together with other traits)\n\ndata <- read.table(\n  \"data_JMP.txt\",\n  header=TRUE, sep=\"\\t\", na.strings=\"NA\", dec=\",\", strip.white=TRUE)\ndata$year<-as.factor(data$year)\n\ndata_pred_10<-subset(data,predator==1&year==2010)\ndata_pred_10$LokalID <- factor(data_pred_10$LokalID)\ndata_pred_10LokalID <- split(data_pred_10, data_pred_10$LokalID)\n\ndata_pred_11<-subset(data,predator==1&year==2011)\ndata_pred_11$LokalID <- factor(data_pred_11$LokalID)\ndata_pred_11LokalID <- split(data_pred_11, data_pred_11$LokalID)\n\n#2010\n#Standardized\nphen10 <- lapply(data_pred_10LokalID, function (x) {\n  lm(n_eggs_sta ~ most_adv_sta+n_fl_sta+h_shoot_sta, \n     data = x)\n})\n\nphen10coefs<-vector(\"list\", 11) # create list\n\nfor (i in 1:11)  #this is 11 LokalID\n{\n  phen10coefs[[i]]<-summary(phen10[[i]])$coefficients\n}\n\nphen10coefs\n\nnames(phen10coefs)<-names(phen10)\nphen10coefs\nphen10coefs<-do.call(\"rbind\",lapply(phen10coefs,FUN=data.frame))\nphen10coefs\n#Add asterisks for significance\nphen10coefs$sig <- ifelse(phen10coefs$Pr...t.. < 0.05,\"*\", \"\")\nphen10coefs\n\n#2011\n#Standardized\nphen11 <- lapply(data_pred_11LokalID, function (x) {\n  lm(n_eggs_sta ~ most_adv_sta+n_fl_sta+h_shoot_sta, \n     data = x)\n})\n\nphen11coefs<-vector(\"list\", 11) # create list\n\nfor (i in 1:11)  #this is 11 LokalID\n{\n  phen11coefs[[i]]<-summary(phen11[[i]])$coefficients\n}\n\nphen11coefs\n\nnames(phen11coefs)<-names(phen11)\nphen11coefs\nphen11coefs<-do.call(\"rbind\",lapply(phen11coefs,FUN=data.frame))\nphen11coefs\n#Add asterisks for significance\nphen11coefs$sig <- ifelse(phen11coefs$Pr...t.. < 0.05,\"*\", \"\")\nphen11coefs\n\n\n######################################################################\n\n\n#Ants\n#Read data\nants_mean_max <- read.table(\n  \"ants_mean_max.txt\",\n  header=TRUE, sep=\"\\t\", na.strings=\"NA\", dec=\",\", strip.white=TRUE)\n\nants_mean_max\nstr(ants_mean_max)\n\nants_mean_max$logants<-log(ants_mean_max$ants_max+0.025)\nlogistic<-glm(pred~logants,data=ants_mean_max,family=binomial)\nsummary(logistic)\npar(mfrow=c(1,1),family=\"serif\")\nplot(ants_mean_max$logants,ants_mean_max$pred,xlab=\"Myrmica abundance (log)\",ylab=\"M. alcon presence\",bty=\"l\",pch=20,family=\"serif\")\ncurve(predict(logistic, data.frame(logants=x), type=\"resp\"), add=TRUE) \nlegend(\"topleft\", legend = \"p = 0.045\",bty = \"n\") \n\nants_mean_max$LokalID<-ants_mean_max$pop\nantstry<-merge(ants_mean_max,data10,by=\"LokalID\")\nantstry<-merge(ants_mean_max,data11,by=\"LokalID\")\n\nsummary(with(subset(antstry,pred==1),lm(n_eggs~logants)))     ###SIGNIF!! -but negative effect!\nwith(subset(antstry,pred==1),plot(logants,n_eggs))\nabline(with(subset(antstry,pred==1),lm(n_eggs~logants)))\nlogistic2<-glm(attack~logants,data=subset(antstry,pred==1),family=binomial)\nsummary(logistic2)\nwith(subset(antstry,pred==1),plot(logants,attack))\ncurve(predict(logistic2, data.frame(logants=x), type=\"resp\"), add=TRUE) \n\n###################################################################################\nants_intensity <- read.table(\n  \"ants_intensity.txt\",\n  header=TRUE, sep=\"\\t\", na.strings=\"NA\", dec=\",\", strip.white=TRUE)\nants_intensity\nants_intensity$propattack_prop<-ants_intensity$propattack/100\n\nsummary(lm(meaneggs~logants,data=subset(ants_intensity,year==2010)))\nsummary(lm(meaneggs~logants,data=subset(ants_intensity,year==2011)))\nsummary(lm(propattack~logants,data=subset(ants_intensity,year==2010)))\nsummary(lm(propattack~logants,data=subset(ants_intensity,year==2011)))               \n\n\npar(mfrow=c(1,1),col=\"black\",pch=20,family=\"serif\",bty=\"l\",cex=1.5,cex.axis=0.5,cex.lab=0.6,mar=c(4, 4, 0.5, 0.5) + 0.1)\nplot(ants_mean_max$logants,ants_mean_max$pred,xlab=\"\",ylab=expression(italic(M.alcon)~presence),\n     bty=\"l\",pch=20,family=\"serif\",xlim=c(-4, 4))\ncurve(predict(logistic, data.frame(logants=x), type=\"resp\"), add=TRUE) \n\nat1<-seq(from = -2, to = 2.5, by = 0.5)\nwith(ants_intensity,plot(logants,meaneggs,col = c(\"black\",\"grey\")[as.factor(year)],\n                         xlab=\"\",ylab=\"Mean number of eggs\",xaxt=\"n\",xlim=c(-1.6, 2.6), ylim=c(0, 14)))\naxis(side = 1, at = at1)\n\nwith(ants_intensity,plot(logants,propattack_prop,col = c(\"black\",\"grey\")[as.factor(year)],\n                         xlab=expression(italic(Myrmica)~\"abundance (log)\"),ylab=\"Proportion of plants attacked\",\n                         xaxt=\"n\",xlim=c(-1.6, 2.6), ylim=c(0, 0.7)))\naxis(side = 1, at = at1)\n###################################################################################\n\n\n\n",
    "created" : 1444927401682.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "975991896",
    "id" : "40AFAE54",
    "lastKnownWriteTime" : 1462448765,
    "last_content_update" : 1462448765608,
    "path" : "D:/SU/Projects/selection_flowering_phenology/code/Gentiana_phen_2010-2011/additional.R",
    "project_path" : "additional.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 8,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}